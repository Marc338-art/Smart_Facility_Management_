heating:
  alias: Heizung für 90 Minuten - C005
  description: Setzt die Temperatur C005-Thermostate auf die aktuelle Temperatur des
    Wandthermostats und hält diese für 90 Minuten
  mode: restart
  fields:
    temperature:
      description: Zieltemperatur für die Thermostate in C005
      example: '21.5'
  variables:
    climate_entities_modellhaus: '{{ expand(''group.modellhaus'') | map(attribute=''entity_id'')
      | list }}'
  sequence:
  - repeat:
      for_each: '{{ climate_entities_modellhaus }}'
      sequence:
      - service: climate.set_temperature
        target:
          entity_id: '{{ repeat.item }}'
        data:
          temperature: '{{ temperature | float }}'
  - delay: 00:90:00
  - repeat:
      for_each: '{{ climate_entities_modellhaus }}'
      sequence:
      - service: climate.set_temperature
        target:
          entity_id: '{{ repeat.item }}'
        data:
          temperature: '{{ states(''input_number.heating_temperature_c005'') | float
            }}'
heizung_manuell_an:
  alias: Heizung manuell an und andere aus
  sequence:
  - target:
      entity_id: automation.heizung_manuell
    action: automation.turn_on
    data: {}
  - target:
      entity_id: automation.stundenplan_steuerung
    data:
      stop_actions: true
    action: automation.turn_off
  - target:
      entity_id: input_select.heiz_modus
    data:
      option: manuell
    action: input_select.select_option
  - target:
      entity_id: scene.unterricht
    action: scene.turn_on
    data: {}
  mode: single
  description: ''
heizung_stundenplan_an:
  alias: Heizung Stundenplan an und andere aus
  sequence:
  - service: automation.turn_on
    target:
      entity_id: automation.stundenplan_steuerung
  - service: automation.turn_off
    target:
      entity_id:
      - automation.heizung_manuell
  - service: input_select.select_option
    target:
      entity_id: input_select.heiz_modus
    data:
      option: stundenplan
  mode: single


ferienmodus:
  alias: Ferienmodus an und andere aus 
  sequence:
    - service: automation.turn_off
      target:
        entity_id: automation.stundenplan_steuerung
      data:
        stop_actions: true

    - service: automation.turn_off
      target:
        entity_id: automation.heizung_manuell
      data:
        stop_actions: true

    - service: scene.turn_on
      target:
        entity_id: scene.ferien

    - service: input_select.select_option
      target:
        entity_id: input_select.heiz_modus
      data:
        option: ferienmodus
  mode: single
  description: ''

set_heating_temperatures:
  alias: Heiztemperaturen setzen
  sequence:
    - variables:
        raumliste:
          - raumcode: "c005"
            climate_entity: "climate.c005_int0000001"
          - raumcode: "c009"
            climate_entity: "climate.c009_int0000002"
    - repeat:
        for_each: "{{ raumliste }}"
        sequence:
          - variables:
              input_entity: >
                {{ 'input_number.heating_temperature_' ~ repeat.item.raumcode }}
              temperature: "{{ states(input_entity) | float }}"
          - service: climate.set_temperature
            data:
              temperature: "{{ temperature }}"
            target:
              entity_id: "{{ repeat.item.climate_entity }}"
          - service: system_log.write
            data:
              message: >
                Temperatur {{ temperature }}°C gesetzt für {{ repeat.item.climate_entity }}
                (Wert aus {{ input_entity }})
              level: info





