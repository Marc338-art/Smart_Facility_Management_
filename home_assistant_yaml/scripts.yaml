heating:
  alias: Heizung für 90 Minuten - C005
  description: Setzt die Temperatur C005-Thermostate auf die aktuelle Temperatur des Wandthermostats und hält diese für 90 Minuten
  mode: restart
  fields:
    temperature:
      description: Zieltemperatur für die Thermostate in C005
      example: '21.5'
  variables:
    climate_entities_modellhaus: "{{ expand('group.modellhaus') | map(attribute='entity_id') | list }}"
  sequence:
    - repeat:
        for_each: "{{ climate_entities_modellhaus }}"
        sequence:
          - service: climate.set_temperature
            target:
              entity_id: "{{ repeat.item }}"
            data:
              temperature: "{{ temperature | float }}"
    - delay: "00:90:00"
    - repeat:
        for_each: "{{ climate_entities_modellhaus }}"
        sequence:
          - service: climate.set_temperature
            target:
              entity_id: "{{ repeat.item }}"
            data:
              temperature: "{{ states('input_number.heating_temperature_c005') | float }}"

heizung_manuell_an:
  alias: Heizung manuell an und andere aus
  sequence:
    - service: automation.turn_on
      target:
        entity_id: automation.heizung_manuell

    - service: automation.turn_off
      target:
        entity_id: automation.Heiztemperaturen_zyklisch_setzen

    - service: scene.turn_on
      target:
        entity_id: scene.unterricht

    - service: input_select.select_option
      target:
        entity_id: input_select.heiz_modus
      data:
        option: manuell
  mode: single

heizung_stundenplan_an:
  alias: Heizung Stundenplan an und andere aus
  sequence:
    - service: automation.turn_on
      target:
        entity_id: automation.Heiztemperaturen_zyklisch_setzen

    - service: automation.turn_off
      target:
        entity_id: automation.heizung_manuell

    - service: scene.turn_on
      target:
        entity_id: scene.unterricht

    - service: input_select.select_option
      target:
        entity_id: input_select.heiz_modus
      data:
        option: stundenplan
  mode: single

ferienmodus:
  alias: Ferienmodus an und andere aus
  sequence:
    - service: automation.turn_off
      target:
        entity_id: automation.Heiztemperaturen_zyklisch_setzen

    - service: automation.turn_off
      target:
        entity_id: automation.heizung_manuell

    - service: scene.turn_on
      target:
        entity_id: scene.ferien

    - service: input_select.select_option
      target:
        entity_id: input_select.heiz_modus
      data:
        option: ferienmodus
  mode: single

set_heating_temperatures:
  alias: Heiztemperaturen setzen
  sequence:
    - variables:
        raumliste:
          - raumcode: "c001"
            climate_entity: "climate.c001_int0000003"
          - raumcode: "c002"
            climate_entity: "climate.c002_int0000004"
          - raumcode: "c003_1"
            climate_entity: "climate.c003_1_int0000005"
          - raumcode: "c003_3"
            climate_entity: "climate.c003_3_int0000008"
          - raumcode: "c004"
            climate_entity: "climate.c004_int0000011"
          - raumcode: "c005"
            climate_entity: "climate.c005_int0000001"
          - raumcode: "c011"
            climate_entity: "climate.c011_int0000017"
          - raumcode: "c016"
            climate_entity: "climate.c016_int0000022"
          - raumcode: "c017"
            climate_entity: "climate.c017_int0000023"
    - repeat:
        for_each: "{{ raumliste }}"
        sequence:
          - variables:
              input_entity: >
                {{ 'input_number.heating_temperature_' ~ repeat.item.raumcode }}
              temperature: "{{ states(input_entity) | float }}"
          - service: climate.set_temperature
            data:
              temperature: "{{ temperature }}"
            target:
              entity_id: "{{ repeat.item.climate_entity }}"
          - service: system_log.write
            data:
              message: >
                Temperatur {{ temperature }}°C gesetzt für {{ repeat.item.climate_entity }} (Wert aus {{ input_entity }})
              level: info
